{#
/**
 * sitemap plugin for Craft CMS 3.x
 *
 * sitemap index.twig
 *
 * @author    Johan Zandstra
 * @copyright Copyright (c) 2017 Johan Zandstra
 * @link      https://github.com/Dolphiq/craft3-plugin-sitemap
 * @package   Sitemap
 * @since     1.0.0
 */
#}

{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set fullPageForm = true %}

{% do view.registerAssetBundle("dolphiq\\sitemap\\assetbundles\\sitemap\\SitemapAsset") %}
{% do view.registerAssetBundle("dolphiq\\sitemap\\assetbundles\\indexcpsection\\IndexCPSectionAsset") %}


{# The title of this CP section #}
{% set title = "Sitemap settings" %}

{# The URL to this plugin's base CP section #}
{% set pluginCpUrl = url('sitemap') %}

{# Get a URL to an image in our AssetBundle #}
{% set iconUrl = view.getAssetManager().getPublishedUrl('@dolphiq/sitemap/assetbundles/indexcpsection/dist', true) ~ '/img/Index-icon.svg' %}


{# The content of the CP Section#}
{% block content %}

    {% set sitemapErrors = [] %}
    {% set sitemapRows = [{
        'heading': 'Include',
        'enabled': include('_includes/forms/lightswitch', {
    name: 'test',
    on: true,
    value: 1,
    small: true
    }),
        'priority': '1',
        'changefreq' : 'monthly',
        'entries' : 4
    }] %}
    {{ forms.editableTableField({
        label: "Site Settings"|t('app'),
        instructions: "Choose which sites this section should be available in, and configure the site-specific settings."|t('app'),
        id: 'sitemaps',
        name: 'sitemaps',
        cols: {
            heading: {
                type: 'heading',
                heading: "Include in Sitemap"|t('app'),
                class: 'thin'
            },
            enabled: {
                type: 'heading',
                class: 'thin',
                name: 'test',

                value: '1',
                small: true
            },

            changefreq: {
                heading : 'Change frequency',
                type: 'select',
                options: [
                    {label: 'always', value: 'always'},
                    {label: 'hourly', value: 'hourly'},
                    {label: 'daily', value: 'daily'},
                    {label: 'weekly', value: 'weekly'},
                    {label: 'monthly', value: 'monthly'},
                    {label: 'yearly', value: 'yearly'},
                    {label: 'never', value: 'never'}
                ]
            },
            priority: {
                heading : 'Priority',
                type: 'select',
                options: [{label: 'Foo', value: 'foo'}, {label: 'Bar', value: 'bar'}]
            },
            entries: {
                heading : 'Entries',
                type: 'heading',
            }
        },
        rows: sitemapRows,
        staticRows: true,
        errors: sitemapErrors|unique
    }) }}
{% endblock %}

{% js %}
var $sitemapRows = $('#sitemaps').children('tbody').children(),
$lightswitches = $sitemapRows.children('th:nth-child(2)').children('.lightswitch');


console.log($lightswitches);

function updateSitemaps() {
    console.log('updateSitemaps');
    $lightswitches.each(function() {
        if ($(this).data('lightswitch').on) {
            $(this).parent().nextAll('td').removeClass('disabled').find('textarea,div.lightswitch,input').attr('tabindex', '0');
        } else {
            $(this).parent().nextAll('td').addClass('disabled').find('textarea,div.lightswitch,input').attr('tabindex', '-1');
        }
    });
}

$lightswitches.on('change', updateSitemaps);

Garnish.$doc.ready(function() {
// updateSites();
});


{% endjs %}